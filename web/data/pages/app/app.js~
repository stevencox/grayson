<html>
  <head>
    <title>{{app.title}}</title>
  </head>
  <body>
    <p>Welcome {{app.username}}.  {{path}}</p>
    <div style='border:lightgray 1px solid'>
      <form id='run_form' action='/run/' method='post' enctype="multipart/form-data">{% csrf_token %}
	<input type='file' name='workflow' size='40' value='Upload'/>
	<input type='submit' value='Run'/>
      </form>
    </div>
  </body>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js"><script/>
  <script type="text/javascript">
function display_event (json) {
  data = $.parseJSON (json)
  document.body.append ("<b><p>" + data + "</p></b>")
}
function grayson_event_feed () {
  //make another request
  $.ajax({
    cache: false,
    dataType: 'json',
    type: "GET",
    url: "localhost:8001/real_time_feed",
    error: function () {
      //don't flood the servers on error, wait 10 seconds before retrying
      setTimeout(grayson_event_feed, 10*1000);
    },
    success: function (json) {
      display_event(json);

      //if everything went well, begin another request immediately
      //the server will take a long time to respond
      //how long? well, it will wait until there is another message
      //and then it will return it to us and close the connection.
      //since the connection is closed when we get data, we longPoll again
      grayson_event_feed();
    }
  });
}
grayson_event_feed()
  </script>

</html>
